<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
  box-sizing: border-box;
}

.row {
  min-height: 80vh;
}

.row::after {
  content: "";
  clear: both;
  display: table;
}

[class*="col-"] {
  float: left;
  padding: 1em;
}

html {
  font-family: "Lucida Sans", sans-serif;
}

body {
  background-color: #000000;
  background-image: linear-gradient(147deg, #000000 0%, #434343 74%);
  color:  white;
  margin: 0;
}

.header {
  color: #ffffff;
  padding: 1em;
  margin: 0;
  border-bottom: 1px solid grey;
  min-height: 10vh;
}

.menu ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.menu li {
  padding: 0.5em;
  margin-bottom: 1.5em;
  background-color: transparent;
  color: #ffffff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  border-radius: 5px;
  min-height: 3em;
  line-height: 3em;
  font-size: 1em;
  border-bottom: 1px solid white;
}

.menu li:hover {
  background-color: lightseagreen;
}

.aside {
  background-color: #33b5e5;
  padding: 1em;
  color: #ffffff;
  text-align: center;
  font-size: 1em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  border-radius: 5px;
  height: 20.5em;
}

.footer {
  color: #ffffff;
  text-align: center;
  font-size: 0.8em;
  padding: 1em;
  border-bottom: 1px solid grey;
  border-top: 1px solid grey;
  min-height: 10vh;
}

/* For mobile phones: */
[class*="col-"] {
  width: 100%;
}

@media only screen and (min-width: 600px) {
  /* For tablets: */
  .col-s-1 {width: 8.33%;}
  .col-s-2 {width: 16.66%;}
  .col-s-3 {width: 25%;}
  .col-s-4 {width: 33.33%;}
  .col-s-5 {width: 41.66%;}
  .col-s-6 {width: 50%;}
  .col-s-7 {width: 58.33%;}
  .col-s-8 {width: 66.66%;}
  .col-s-9 {width: 75%;}
  .col-s-10 {width: 83.33%;}
  .col-s-11 {width: 91.66%;}
  .col-s-12 {width: 100%;}
}
@media only screen and (min-width: 768px) {
  /* For desktop: */
  .col-1 {width: 8.33%;}
  .col-2 {width: 16.66%;}
  .col-3 {width: 25%;}
  .col-4 {width: 33.33%;}
  .col-5 {width: 41.66%;}
  .col-6 {width: 50%;}
  .col-7 {width: 58.33%;}
  .col-8 {width: 66.66%;}
  .col-9 {width: 75%;}
  .col-10 {width: 83.33%;}
  .col-11 {width: 91.66%;}
  .col-12 {width: 100%;}
}


</style>
</head>
<body>

<div class="header">
  <h1>Homework Blockchain</h1>
</div>

<div class="row">
  <div class="col-3 col-s-3 menu">
    <ul>
      <li id="btn_connect_to_chain" onclick="connectToChain()">Connect To Chain</li>
      <li id="btn_my_tokens" onclick="showMyTokens()">My Tokens</li>
      <li id="btn_admin_site" style="display: none;" onclick="showAdminSite()">Admin</li>
      <li id="btn_about" onclick="showAbout()">About</li>
    </ul>
  </div>

  <div id="nft_collection" class="col-9 col-s-9" style="display:none">
    <h1>Collection</h1>
    <div class="col-12 col-s-12" style="border: solid 1px grey;">
       <button type="button" style="margin-right: 2em; ;background-color: lightseagreen; color:  white;height: 2em; width: 4em;" onclick="prevToken()">&larr;</button>
      
       <input type="number" id="token_id" name="token_id" placeholder="1" min="1" max="216" value="1" style="height: 2em;"><button type="button" onclick="showToken(document.getElementById('token_id').value)" style="background-color: lightseagreen; color:  white;height: 2em; width: 4em;">&crarr;</button>
      
       <button type="button" style="margin-left: 2em; background-color: lightseagreen; color:  white;height: 2em; width: 4em;" onclick="nextToken()">&rarr;</button>
       <span id="token_progress" style="float: right;">1 out of 216</span>
    </div>

    <div id="img_holder" class="col-6 col-s-6">
      <svg height="300" width="300">
        <circle cx="50%" cy="50%"   r="150" fill="black"/>
        <circle cx="50%" cy="50%"  r="50" fill="rgb(0,0,0)" />
        <text x="25%" y="25%" fill="white">#1</text>
      </svg>
    </div>
    <div id="img_data_holder" class="col-6 col-s-6">  
      <p>Token id: 1</p>
      <p>Circle color: rgb(0,0,0)</p>
    </div>
     <div class="col-12 col-s-12" style="border: solid 1px grey;">
       <span id="minted_status"></span>
       <button type="button" style="float: right; background-color: lightseagreen; color:  white;height: 2em; width: 14em;" onclick="mintAvailToken()">Mint Next Available</button>
     </div>
     
  </div>

  <div id="my_tokens" class="col-9 col-s-9" style="display:none">
    <h1>My Tokens</h1>
    <div id="my_tokens_list"></div>
  </div>

  <div id="admin_site" class="col-9 col-s-9" style="display:none">
    <h1>Admin Site</h1>
      <div>
        <select class="" id="functions_list" name="functions_list" onchange="functionsListOnchange('nft_contract','functions_list','function_call_panel','call_result' )"></select>
      </div>
      <div id="function_call_panel" style="display: none; overflow-wrap: break-word;"></div>
  </div>

  <div id="about" class="col-9 col-s-9" style="display:none">
    <h1>About</h1>
    <p>Fully decentralized, on-chain NFT collection.</p>
    <p>Only 216 unique tokens. Art is generated by algorithm in smart contract. No external script is used.</p>
    <p>All metadata is stored directly in smartcontract, no off-chain storage used.</p>
    <p>Site itslef is hosted on IPFS, which is decentralized storage.</p>
    <p>For maximul "liteness" site is created on pure JS/HTML5/CSS3, no frameworks are used.</p>
    <p>Domain name is registered in decentralized Ethereum Name Service.</p>
    <p>Metamask is needed to interact with site.</p>
    <!--<p style="color:grey;">Coursework of Pavel Chekriy, HSE University, Faculty of Computer Science, 2022</p>-->
  </div>

  
</div>

<div class="footer">
  <p id='msg' style='color: white'>Optimized for desktop browser. Connect your Metamask to Ethereum Network (mainnet). Payment in USDT</p>
</div>

<script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
        type="application/javascript"></script>
<script type="text/javascript">
  let provider;
  let signer;
  let account;

  

  let nft_contract;
  let nft_address; 
  const nft_abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_owner","type":"address"},{"indexed":true,"internalType":"address","name":"_approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_owner","type":"address"},{"indexed":true,"internalType":"address","name":"_operator","type":"address"},{"indexed":false,"internalType":"bool","name":"_approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_from","type":"address"},{"indexed":true,"internalType":"address","name":"_to","type":"address"},{"indexed":true,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"CANNOT_TRANSFER_TO_ZERO_ADDRESS","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NOT_CURRENT_OWNER","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_approved","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"contractURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"exist","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"},{"internalType":"address","name":"_operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"numOfToken","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"mintLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"numOfToken","type":"uint256"}],"name":"mintOwner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"_name","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"_owner","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicSalePrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_operator","type":"address"},{"internalType":"bool","name":"_approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"newContractUri","type":"string"}],"name":"setContractURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newLimit","type":"uint256"}],"name":"setMintLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"new_name","type":"string"}],"name":"setNFTName","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"new_symbol","type":"string"}],"name":"setNFTSymbol","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newPrice","type":"uint256"}],"name":"setPublicSalePrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"_interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"_symbol","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"},{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

  
  
  (async () => {
    //code which will run on page load
  })();

  function setMsg(id, value, disp = 'block', color='white') {
    var el = document.getElementById(id);
    if (el) {
      el.innerHTML = value;
      el.style.color = color;
      if (value == '') el.style.display = 'none';
      else el.style.display = disp;
    }
  }

 

  async function connectToChain(){
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const { chainId } = await provider.getNetwork();
        if ( !(chainId == 4 || chainId == 1) )  throw 'wrong chainId';

        if (chainId == 4){
          nft_address= '0xeD2c370eF3688B92Ab21D972AF9be9A1c12afC51';
        } else if (chainId == 1){
          nft_address = '0x0Ac98C8a81De228861B8cB9d3F7e9eF766CBBeff';
        }


        const accounts = await provider.listAccounts();
        account = accounts[0];

        

        nft_contract = new ethers.Contract( nft_address, nft_abi, signer);        

        setMsg('msg','Optimized for desktop browser. Connect your Metamask to Ethereum mainnet.');
        showToken(1);
        showAbout();

        if (await nft_contract.owner() == account) document.getElementById('btn_admin_site').style.display = 'block';
    } catch (e) {
        setMsg('msg','please connect Metamask to Ethereum mainnet (or rinkeby for test)','block','red');
    }
  }  

  async function showMyTokens(){
      document.getElementById('nft_collection').style.display = 'none'; 
      document.getElementById('my_tokens').style.display = 'block';  
      document.getElementById('admin_site').style.display = 'none'; 
      document.getElementById('about').style.display = 'none';    
      await listMyTokens();
  }

  async function showAdminSite(){
      document.getElementById('nft_collection').style.display = 'none'; 
      document.getElementById('my_tokens').style.display = 'none';  
      document.getElementById('admin_site').style.display = 'block'; 
      document.getElementById('about').style.display = 'none';       

      fillFunctionsList(document.getElementById('functions_list'),nft_abi);  
  }

  async function showAbout(){
      document.getElementById('nft_collection').style.display = 'none'; 
      document.getElementById('my_tokens').style.display = 'none';  
      document.getElementById('admin_site').style.display = 'none'; 
      document.getElementById('about').style.display = 'block';     
  }

  function genSVG(tokenId) {
    return '<svg height="300" width="300"><circle cx="50%" cy="50%" r="150" fill="black"/><circle cx="50%" cy="50%"  r="50" fill="'+getColor(tokenId)+'" />'+
    '<text x="25%" y="25%" fill="white">#'+tokenId.toString()+'</text></svg>';
  }



  let colors = [0,50,100,150,200,255];

  function getColor(tokenId){
    tokenId--;
    let c1 = parseInt(colors[~~ (tokenId / 36)]);
    let c2i = ~~ (tokenId / 6);
    if (c2i >=6 ) c2i = c2i % 6;
    let c2 = parseInt(colors[c2i]);
    let c3 = parseInt(colors[(tokenId % 6)]);
    return ('rgb('+c1.toString()+','+c2.toString()+','+c3.toString()+')');
  }

  function nextToken(){
      let tokenId = parseInt(document.getElementById("token_id").value);

      if (tokenId < 216){
        tokenId++;
        document.getElementById("token_id").value = tokenId;
        showToken(tokenId);
      } 
  }

  function prevToken(){
      let tokenId = parseInt(document.getElementById("token_id").value);
      if (tokenId > 1){
        tokenId--;
        document.getElementById("token_id").value = tokenId;
        showToken(tokenId);  
      } 
  }

  async function showToken(tokenId){
    if (tokenId > 216 || tokenId < 1){
      document.getElementById('img_holder').innerHTML = 'not valid token ID; valid range 1 - 216';
      document.getElementById('img_data_holder').innerHTML = '';
    } else {
      document.getElementById("token_id").value = tokenId;
      document.getElementById("token_progress").innerHTML = tokenId.toString()+' out of 216';
      document.getElementById('img_holder').innerHTML = genSVG(tokenId);
      document.getElementById('img_data_holder').innerHTML = '<p>Token id: '+tokenId.toString()+'</p><p>Circle color: '+getColor(tokenId)+'</p>';
      if (await nft_contract.exist(tokenId)){
            document.getElementById('minted_status').innerHTML = 'MINTED';
      } else {
            document.getElementById('minted_status').innerHTML = 'AVAILABLE'; 
      }
    
    }
  }

  async function mintAvailToken(){
    try {
      
      let tx = await nft_contract.mint(1, {
                                                value: (await nft_contract.publicSalePrice()).toString()
                                              }); 
      await tx.wait();
     
      setMsg('msg','last transaction hash: '+tx.hash);
      

    } catch(e){
       
       setMsg('msg','transaction error','block','red');
      
    }

  }

  async function listMyTokens(){
    try {
      let list='';
      let my_tokens_total = parseInt(await nft_contract.balanceOf(account)); 
      
      for (let i=0; i < my_tokens_total; i++){
          let t_id = await nft_contract.tokenOfOwnerByIndex(account,i);
          list = list+ '<div class="col-6 col-s-6" >'+genSVG(t_id)+'</div>';
      }      
      document.getElementById('my_tokens_list').innerHTML = list;
    } catch(e){
       
       setMsg('msg','transaction error','block','red');
      
    }

  }

  /* ======   ADMIN functions ======= */
  async function fillFunctionsList(list_elem, abi){
    
    let option;

    for(let i=0; i< abi.length; i++){
      
      
      option = document.createElement('option');
      if (abi[i].type == "function"){ 
        option.text = abi[i].name; //name
        let json_details = abi[i];
        option.value =  JSON.stringify(json_details);
        
        list_elem.add(option);
      }
    }   
    
  }

  function functionsListOnchange(contract, functions_list_id, function_call_panel, call_results_id){

    let functions_list = document.getElementById(functions_list_id);  
    if (functions_list.selectedIndex > 0){
      var val = JSON.parse(functions_list.value);
      

      let html = '';
      for(let i=0; i< val.inputs.length; i++){
        html += '<div class="adm_smc_main">'; 
          html += '<label for="'+val.inputs[i].name+'" class="adm_smc_label">'+val.inputs[i].name+':</label>'; 
          let dl='';
          if (val.inputs[i].type == "bool") dl='list="bool_list"';
          html += '<div class="adm_smc_div_input">';
            html += '<input type="text" '+dl+' id="'+val.inputs[i].name+'_smc_id" class="adm_smc_input" placeholder="" value="" name="'+val.inputs[i].name+'">'; 
          html += '</div>';
          if (val.inputs[i].type == "bool") html += '<datalist id="bool_list"><option value="true"><option value="false"></datalist>';
          html += '<div class="adm_smc_input_type">';
            html += '<span>' +val.inputs[i].type+' </span>'; 
          html += '</div>';
        html += '</div>';
      }
      if (val.stateMutability == "payable"){
        html += '<div class="adm_smc_div_payable">';  
          html += '<label for="send_wei_value" class="adm_smc_label_payable">Send value, wei:</label>'; 
          html += '<div class="adm_smc_div_input_payable">';
            html += '<input type="text" id="send_wei_value" class="adm_smc_input_payable" placeholder="" value="" name="send_wei_value">'; 
          html += '</div>';
          html += '<div class="adm_smc_val_payable">';
            html += '<span>Value in wei to be send</span>'; 
          html += '</div>';
        html += '</div>';
      }
      html += '<div class="adm_smc_div_btn_call">'; 
        html += '<div class="adm_smc_div_btn_call_wrap">';
          html += '<button class="adm_smc_div_btn"  onclick="callSmartcontractFunction('+"'"+contract+"'"+','+"'"+functions_list_id+"'"+','+"'"+call_results_id+"'"+')">Call</button>';
        html += '</div>';
      html += '</div>';
        
      html += '<div class="adm_smc_div_result">'; 
        html += '<div class="adm_smc_div_result_wrap">';
          html += '<textarea class="adm_smc_textarea"  id="'+call_results_id+'"  readonly></textarea>';
        html += '</div>';
      html += '</div>';   
      
      html += '<div class="adm_smc_call_src" style="display:none">';  
        html += '<div class="adm_smc_call_src_wrap">';
          html += '<textarea class="adm_smc_textarea"  id="'+call_results_id+'_src"  readonly></textarea>';
        html += '</div>';
      html += '</div>'; 


      safeSetInnerHTMLById(function_call_panel,html);
    }
  }

  async function callSmartcontractFunction(contract, functions_list_id, call_results){

    let functions_list = document.getElementById(functions_list_id);

    

    var function_data = JSON.parse(functions_list.value);
    
    let params = '';
    for(let i=0; i< function_data.inputs.length; i++){
      if (function_data.inputs[i].type.includes('[]')) {
        params += '[';
      } else if (function_data.inputs[i].type == "bool"){
        //  
      }
      else { //if (function_data.inputs[i].type == "address" || function_data.inputs[i].type == "string" ){
        params += '"';
      }

      params += document.getElementById(function_data.inputs[i].name+'_smc_id').value;
      
      if (function_data.inputs[i].type.includes('[]')) {
        params += ']';
      } else if (function_data.inputs[i].type == "bool"){
        //    
      } else {
        params += '"';
      }

      if (i< function_data.inputs.length-1) params += ',';
    }
    
    let eval_str ='';
    if (function_data.stateMutability == "view" || function_data.stateMutability == "pure"){
      eval_str = contract+"."+function_data.name+"("+params+")";
      
    } else if (function_data.stateMutability == "nonpayable"){
      eval_str = contract+"."+function_data.name+"("+params+")";   
      
    } else if (function_data.stateMutability == "payable"){
      eval_str = contract+"."+function_data.name+"("+params+",{ value:"+ document.getElementById('send_wei_value').value+" })";    
    } 

    safeSetInnerHTMLById(call_results+'_src','let x = await '+eval_str);
    let res = await eval(eval_str);
    if (typeof res == 'object') {
      safeSetInnerHTMLById(call_results,(JSON && JSON.stringify ? JSON.stringify(res) : res) );
      } else {
          safeSetInnerHTMLById(call_results,res);
      }

  }

  function safeSetInnerHTMLById(id, value, disp = 'block'){
    var el = document.getElementById(id);
    if (el){
       el.innerHTML = value;
       if (value == '' ) el.style.display = "none"
       else el.style.display = disp;
    }
  }

</script>
</body>
</html>


